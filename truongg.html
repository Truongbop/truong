<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trắc nghiệm Lịch sử Phát triển Phần mềm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover:not(:disabled) {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover:not(:disabled) {
            background: #d39e00;
            transform: translateY(-2px);
        }
        
        .quiz-info {
            display: flex;
            gap: 20px;
            align-items: center;
            font-weight: 600;
            color: #495057;
            margin-left: auto;
        }
        
        .quiz-content {
            padding: 30px;
        }
        
        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #007bff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s ease;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .question-number {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .question-text {
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #212529;
            font-weight: 500;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .option:hover {
            border-color: #007bff;
            transform: none;
        }
        
        .option.full-width {
            grid-column: span 2;
        }
        
        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.2);
            cursor: pointer;
        }
        
        .option label {
            cursor: pointer;
            flex: 1;
            font-size: 1.1em;
            line-height: 1.5;
        }
        
        .option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724 !important;
        }
        
        .option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24 !important;
        }
        
        .drop-area .drag-item.correct {
            background-color: #d4edda !important;
        }
        
        .drop-area .drag-item.incorrect {
            background-color: #f8d7da !important;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .results {
            text-align: center;
            padding: 40px;
        }
        
        .results h2 {
            font-size: 2em;
        }
        
        .score {
            font-size: 3em;
            font-weight: bold;
            color: #28a745;
            margin: 20px 0;
        }
        
        .score-details {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            gap: 20px;
        }
        
        .score-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            flex: 1;
            border: 2px solid #e9ecef;
        }
        
        .score-item h3 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        .score-item .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            .header h1 {
                font-size: 2em;
            }
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            .quiz-info {
                flex-direction: row;
                justify-content: space-around;
                width: 100%;
                margin-top: 10px;
                margin-left: 0;
            }
            .navigation {
                flex-direction: row;
                gap: 15px;
            }
            .score-details {
                flex-direction: column;
            }
            .options {
                grid-template-columns: 1fr;
            }
            .option.full-width {
                grid-column: span 1;
            }
            .drag-drop-container {
                flex-direction: column;
            }
        }
        /* === CSS CHO KÉO THẢ (DRAG-DROP) === */
        
        .drag-drop-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .drag-items,
        .drop-targets {
            flex: 1;
            min-width: 250px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
        
        .drag-item {
            background: #e9f5ff;
            border: 1px solid #a0d9ff;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: grab;
            font-weight: 500;
            transition: background-color 0.2s ease;
            overflow-wrap: break-word;
            word-wrap: break-word;
            line-height: 1.4;
        }
        
        .drag-item:hover {
            background-color: #d1eaff;
        }
        
        .drag-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        
        .drop-target {
            background: #f0f0f0;
            border: 2px dashed #bbb;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 8px;
        }
        
        .drop-target.over {
            background-color: #e0ffe0;
            border-color: #28a745;
        }
        
        .drop-target .label {
            font-weight: bold;
            color: #333;
            overflow-wrap: break-word;
            word-wrap: break-word;
            line-height: 1.4;
        }
        
        .drop-area {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            border-radius: 5px;
            background: #e9ecef;
            min-height: 44px;
        }
        /* === CSS CHO ĐIỀN VÀO CHỖ TRỐNG === */
        
        .fill-in-blanks-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .blank-input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .blank-input-group label {
            font-weight: 600;
            color: #333;
        }
        
        .fill-in-blanks-container input[type="text"] {
            padding: 10px 12px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            width: 100%;
            transition: border-color 0.3s ease;
        }
        
        .fill-in-blanks-container input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .fill-in-blanks-container input[type="text"].correct {
            border-color: #28a745;
            background-color: #d4edda;
        }
        
        .fill-in-blanks-container input[type="text"].incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>📖 Trắc nghiệm Lịch sử Phát triển Phần mềm</h1>
            <p>Kiểm tra kiến thức của bạn về quá trình hình thành và phát triển của ngành công nghệ phần mềm.</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <button class="btn btn-primary" id="startBtn" onclick="startQuiz()">Bắt đầu Quiz</button>
                <button class="btn btn-warning" id="shuffleAllBtn" onclick="shuffleAll()">Trộn Câu hỏi & Đáp án</button>
                <button class="btn btn-success" id="resetBtn" onclick="resetQuiz()">Làm lại</button>
                <div class="quiz-info">
                    <span id="totalQuestionsContainer">Tổng số câu: <strong id="totalQuestions">0</strong></span>
                    <span>Thời gian: <strong>Không giới hạn</strong></span>
                </div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="quiz-content" id="quizContent">
            <div class="question-card">
                <h2 style="text-align: center; color: #6c757d; margin: 50px 0;">
                    Nhấn "Bắt đầu Quiz" để bắt đầu làm bài
                </h2>
            </div>
        </div>

        <div class="results hidden" id="results">
            <h2>🎉 Kết quả Quiz</h2>
            <div class="score" id="finalScore">0/0</div>
            <div class="score-details">
                <div class="score-item">
                    <h3>Điểm số</h3>
                    <div class="value" id="percentage">0%</div>
                </div>
                <div class="score-item">
                    <h3>Đúng</h3>
                    <div class="value" id="correctCount">0</div>
                </div>
                <div class="score-item">
                    <h3>Sai</h3>
                    <div class="value" id="incorrectCount">0</div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="resetQuiz()">Làm lại</button>
        </div>
    </div>

    <script>
        // --- Dữ liệu câu hỏi ---
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizStarted = false;
        let questionsForQuiz = [];
        let originalQuestions = [];

        const allQuestions = [{
            type: "single",
            question: "Ai là người thiết kế ra ngôn ngữ lập trình C – ngôn ngữ có ảnh hưởng sâu rộng trong lập trình hệ thống và phát triển phần mềm?",
            options: [
                "Brian Kernighan và Dennis Ritchie",
                "Michael Jackson",
                "Niklaus Wirth",
                "Edsger Dijkstra"
            ],
            correct: [0]
        }, {
            type: "single",
            question: "Theo Dijkstra, điều gì được dùng để đánh giá tay nghề của một lập trình viên?",
            options: [
                "Thời gian họ học đại học",
                "Số lượng module họ có thể viết trong một ngày",
                "Mức độ sử dụng lệnh “goto” – càng nhiều thì tay nghề càng yếu",
                "Số ngôn ngữ lập trình họ biết – càng nhiều thì tay nghề càng cao"
            ],
            correct: [2]
        }, {
            type: "single",
            question: "Mã máy được xem là ngôn ngữ lập trình cơ bản vì lý do nào sau đây?",
            options: [
                "Nó được biểu diễn bằng mã nhị phân và hiểu trực tiếp bởi phần cứng máy tính",
                "Nó được viết bằng ngôn ngữ tự nhiên để người dùng dễ hiểu và lập trình viên dễ lập trình",
                "Nó hoạt động như trình biên dịch trung gian",
                "Nó sử dụng các ký hiệu Latin và dễ ghi nhớ"
            ],
            correct: [0]
        }, {
            type: "single",
            question: "Cuộc khủng hoảng phần mềm trong lịch sử phát triển công nghệ phần mềm bắt đầu vào khoảng thời gian nào?",
            options: [
                "Cuối thập niên 1960 khi phần mềm trở nên phức tạp hơn",
                "Khi máy tính cá nhân phổ biến vào đầu thập niên 1980",
                "Trong giai đoạn đầu thập niên 1940 khi máy tính điện tử ra đời",
                "Đầu thập niên 2000 với sự xuất hiện của lập trình web"
            ],
            correct: [0]
        }, {
            type: "single",
            question: "Ngôn ngữ lập trình Pascal được phát triển dựa trên nền tảng của ngôn ngữ nào dưới đây?",
            options: [
                "Assembly, gần với mã máy",
                "C, với cú pháp đơn giản và mạnh mẽ do Kernighan và Ritchie phát triển",
                "ALGOL W, một biến thể của ALGOL-60 do Wirth phát triển",
                "BASIC, một ngôn ngữ dùng cho người mới học lập trình"
            ],
            correct: [2]
        }, {
            type: "single",
            question: "Đặc điểm nào đúng với các ngôn ngữ lập trình thời kỳ đầu như mã máy và hợp ngữ?",
            options: [
                "Có tính trừu tượng thấp, khó hiểu và phụ thuộc vào phần cứng",
                "Có khả năng chạy trên mọi nền tảng hệ điều hành",
                "Chúng có tính trừu tượng cao, dễ đọc, dễ vận hành và dễ bảo trì",
                "Được thiết kế để độc lập với phần cứng"
            ],
            correct: [0]
        }, {
            type: "single",
            question: "Cuộc khủng hoảng phần mềm đã dẫn đến sự ra đời và phát triển mạnh mẽ của lĩnh vực nào trong công nghệ thông tin?",
            options: [
                "Phần cứng máy tính cá nhân",
                "Trí tuệ nhân tạo ứng dụng trong phần mềm",
                "Công nghệ phần mềm, với các phương pháp phát triển có tổ chức",
                "Công nghệ mạng và truyền thông, với hệ thống mạng internet phát triển"
            ],
            correct: [2]
        }, {
            type: "single",
            question: "Mục tiêu cuối cùng của kỹ thuật lập trình và công nghệ phần mềm là gì?",
            options: [
                "Tối ưu hóa sự phối hợp giữa con người và máy tính",
                "Giảm chi phí phần mềm đến mức tối thiểu",
                "Loại bỏ hoàn toàn lỗi trong chương trình",
                "Xây dựng phần mềm chỉ dùng một ngôn ngữ lập trình"
            ],
            correct: [0]
        }, {
            type: "multiple",
            question: "Công cụ và phương pháp nào được sử dụng phổ biến để nhập chương trình vào máy tính trong những năm 1950–1970? (Chọn 2 đáp án đúng)",
            options: [
                "Máy đục thẻ (punch card machine) do Herman Hollerith phát minh",
                "Nhập lệnh bằng bàn phím cơ và lưu trữ trực tiếp qua ổ cứng SSD",
                "Sử dụng trình soạn thảo văn bản như Notepad kết hợp hệ điều hành dòng lệnh",
                "Thẻ đục lỗ với mỗi lỗ đại diện cho một ký tự mã hóa"
            ],
            correct: [0, 3]
        }, {
            type: "multiple",
            question: "Theo quy trình phát triển phần mềm hiện đại được hình thành sau khủng hoảng, hai yếu tố nào sau đây là then chốt để đảm bảo chất lượng sản phẩm? (Chọn 2 đáp án đúng)",
            options: [
                "Chỉ kiểm thử phần mềm sau khi triển khai để tiết kiệm thời gian phát triển",
                "Tổ chức hợp tác nhóm giữa các vai trò khác nhau như lập trình viên, kiểm thử viên, và phân tích viên",
                "Thiết kế hệ thống hoàn toàn do một lập trình viên kỳ cựu thực hiện",
                "Phân chia chức năng phần mềm thành các module tương đối độc lập"
            ],
            correct: [1, 3]
        }, {
            type: "single",
            question: "ENIAC là ví dụ điển hình cho loại máy tính nào sau đây?",
            options: [
                "Máy tính cá nhân thế hệ mới có khả năng tự học nhờ trí tuệ nhân tạo",
                "Máy tính cá nhân đầu tiên của thế giới",
                "Máy tính có hệ điều hành hiện đại như Windows",
                "Máy tính lập trình cố định, lập trình bằng dây cáp và công tắc"
            ],
            correct: [3]
        }, {
            type: "multiple",
            question: "Trong các yếu tố sau, yếu tố nào là nguyên nhân trực tiếp dẫn đến cuộc khủng hoảng phần mềm vào cuối thập niên 1960? (Chọn 2 đáp án đúng)",
            options: [
                "Độ phức tạp tăng cao do phần mềm ngày càng lớn trong khi kỹ thuật phát triển không theo kịp",
                "Các công cụ biên dịch và kiểm thử đã quá phức tạp, gây khó khăn trong sử dụng",
                "Hệ điều hành không hỗ trợ đủ tính năng đa nhiệm khiến phần mềm dễ treo máy",
                "Thiếu các phương pháp phát triển phần mềm có hệ thống và quy trình chuẩn hóa"
            ],
            correct: [0, 3]
        }, {
            type: "multiple",
            question: "Những tư tưởng lập trình nào dưới đây phản ánh đúng tinh thần cách mạng xuất hiện sau cuộc khủng hoảng phần mềm? (Chọn 2 đáp án đúng)",
            options: [
                "Chú trọng đến tính đúng đắn, dễ hiểu và dễ bảo trì của chương trình",
                "Tách bài toán lớn thành các phần nhỏ hơn có thể giải quyết độc lập",
                "Ưu tiên lập trình bằng ngôn ngữ càng gần với mã máy càng tốt để tăng hiệu năng",
                "Tránh sử dụng cấu trúc điều khiển có điều kiện để đơn giản hóa mã nguồn"
            ],
            correct: [0, 1]
        }, {
            type: "single",
            question: "Trong thời kỳ đầu phát triển của tin học, ngôn ngữ lập trình nào được sử dụng phổ biến nhất để viết chương trình điều khiển máy tính?",
            options: [
                "Ngôn ngữ C++, hỗ trợ lập trình hướng đối tượng",
                "Ngôn ngữ Java, thường dùng trong các ứng dụng di động",
                "Các ngôn ngữ bậc thấp như mã máy và hợp ngữ",
                "Ngôn ngữ Python, với cú pháp hiện đại và dễ học"
            ],
            correct: [2]
        }, {
            type: "drag-drop",
            question: "Ghép giai đoạn quy trình sản xuất phần mềm với người thực hiện tương ứng.",
            dragItems: ["Giai đoạn 1-4", "Giai đoạn 5", "Giai đoạn 6", "Giai đoạn 7", "Giai đoạn 8"],
            dropTargets: [{
                label: "Khảo sát viên",
                correct: "Giai đoạn 1-4"
            }, {
                label: "Phân tích viên",
                correct: "Giai đoạn 5"
            }, {
                label: "Lập trình viên",
                correct: "Giai đoạn 6"
            }, {
                label: "Chuyên viên lập trình trưởng",
                correct: "Giai đoạn 7"
            }, {
                label: "Chuyên viên kiểm thử",
                correct: "Giai đoạn 8"
            }, ]
        }, {
            type: "group-radio",
            question: "Đánh giá tính đúng/sai của các nhận định sau về phương pháp lập trình thủ công trong giai đoạn đầu phát triển máy tính:",
            subQuestions: [{
                stem: "1) Trong thời kỳ này, việc lập trình được thực hiện trực tiếp trên thiết bị thông qua bàn phím và màn hình CRT.",
                options: ["Đúng", "Sai"],
                correct: 1
            }, {
                stem: "2) ENIAC – một trong những máy tính đầu tiên – đã được tích hợp ngôn ngữ lập trình bậc cao như Fortran để hỗ trợ người lập trình.",
                options: ["Đúng", "Sai"],
                correct: 1
            }, {
                stem: "3) Thẻ đục lỗ là công cụ nhập chương trình phổ biến, mỗi lỗ tương ứng với một ký tự hay lệnh mã hóa.",
                options: ["Đúng", "Sai"],
                correct: 0
            }, {
                stem: "4) Lập trình viên thời kỳ đầu thường làm việc đơn lẻ, thiếu sự phân chia rõ ràng vai trò và phối hợp nhóm.",
                options: ["Đúng", "Sai"],
                correct: 0
            }]
        }, {
            type: "group-radio",
            question: "Xác định các phát biểu đúng/sai về tư tưởng lập trình hiện đại và quan điểm của các nhà khoa học:",
            subQuestions: [{
                stem: "1) Pascal là một ngôn ngữ được thiết kế đơn giản, phù hợp để giảng dạy các nguyên lý lập trình có cấu trúc.",
                options: ["Đúng", "Sai"],
                correct: 0
            }, {
                stem: "2) Tony Hoare đã đóng góp các tiên đề chứng minh tính đúng đắn chương trình, góp phần vào lý thuyết lập trình hiện đại.",
                options: ["Đúng", "Sai"],
                correct: 0
            }, {
                stem: "3) Lệnh “goto” được khuyến khích sử dụng trong lập trình hiện đại vì nó giúp chương trình rõ ràng hơn.",
                options: ["Đúng", "Sai"],
                correct: 1
            }, {
                stem: "4) Dijkstra cho rằng các vòng lặp và rẽ nhánh là nguyên nhân làm chương trình sai, nên cần tránh sử dụng hoàn toàn.",
                options: ["Đúng", "Sai"],
                correct: 1
            }]
        }, {
            type: "group-radio",
            question: "Xác định các phát biểu đúng/sai liên quan đến quy trình công nghệ phần mềm và vai trò các chuyên viên:",
            subQuestions: [{
                stem: "1) Quy trình sản xuất phần mềm theo công nghệ thông thường bao gồm 9 giai đoạn rõ ràng, từ phân tích đến thu thập phản hồi.",
                options: ["Đúng", "Sai"],
                correct: 0
            }, {
                stem: "2) Giai đoạn 6 – chuyên gia lập trình trưởng – là người thực hiện kiểm thử phần mềm trước khi giao cho khách hàng.",
                options: ["Đúng", "Sai"],
                correct: 1
            }, {
                stem: "3) Việc phân tích yêu cầu và thiết kế phần mềm là trách nhiệm chính của các lập trình viên ngay từ đầu quy trình.",
                options: ["Đúng", "Sai"],
                correct: 1
            }, {
                stem: "4) Trong giai đoạn mã hóa, lập trình viên nên tận dụng các thuật toán hoặc thủ tục có sẵn để tăng hiệu quả phát triển.",
                options: ["Đúng", "Sai"],
                correct: 0
            }]
        }, {
            type: "fill-in-blanks",
            question: "Điền từ còn thiếu vào câu sau: Trong thời kỳ đầu của __(1)__ , __(2)__ thường viết mã bằng tay trên __(3)__ , sau đó nhập vào máy thông qua __(4)__ hoặc công tắc.",
            blanks: [{
                label: "Điền từ còn thiếu vào chỗ trống (1)",
                answer: "tin học"
            }, {
                label: "Điền từ còn thiếu vào chỗ trống (2)",
                answer: "lập trình viên"
            }, {
                label: "Điền từ còn thiếu vào chỗ trống (3)",
                answer: "giấy"
            }, {
                label: "Điền từ còn thiếu vào chỗ trống (4)",
                answer: "thẻ đục lỗ"
            }, ]
        }, {
            type: "fill-in-blanks",
            question: "Điền từ còn thiếu vào câu sau: Một trong những ___(1)___ chính dẫn đến cuộc khủng hoảng ___(2)___ là do sản xuất phần mềm mang tính ___(3)___ và thiếu tính ___(4)___.",
            blanks: [{
                label: "Điền từ còn thiếu vào ô trống (1)",
                answer: "nguyên nhân"
            }, {
                label: "Điền tử còn thiếu vào ô trống (2)",
                answer: "phần mềm"
            }, {
                label: "Điền tử còn thiếu vào ô trống (3)",
                answer: "thủ công"
            }, {
                label: "Điền tử còn thiếu vào ô trống (4)",
                answer: "chuyên nghiệp"
            }, ]
        }, ];


        // --- Khởi tạo và DOM Elements ---
        document.addEventListener('DOMContentLoaded', initialize);

        function initialize() {
            originalQuestions = JSON.parse(JSON.stringify(allQuestions));
            questionsForQuiz = JSON.parse(JSON.stringify(originalQuestions));
            document.getElementById('totalQuestions').textContent = questionsForQuiz.length;
            document.getElementById('resetBtn').disabled = true;
            document.getElementById('shuffleAllBtn').disabled = false;
        }

        // --- Hàm điều khiển Quiz ---
        function startQuiz() {
            quizStarted = true;
            currentQuestionIndex = 0;
            userAnswers = new Array(questionsForQuiz.length).fill(null);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('shuffleAllBtn').disabled = true;
            document.getElementById('resetBtn').disabled = false;
            displayQuestion();
        }

        function resetQuiz() {
            quizStarted = false;
            currentQuestionIndex = 0;
            userAnswers = [];
            questionsForQuiz = JSON.parse(JSON.stringify(originalQuestions));
            document.getElementById('quizContent').innerHTML = `
            <div class="question-card">
                <h2 style="text-align: center; color: #6c757d; margin: 50px 0;">
                    Nhấn "Bắt đầu Quiz" để bắt đầu làm bài
                </h2>
            </div>`;
            document.getElementById('results').classList.add('hidden');
            document.getElementById('quizContent').classList.remove('hidden');
            document.getElementById('startBtn').disabled = false;
            document.getElementById('shuffleAllBtn').disabled = false;
            document.getElementById('resetBtn').disabled = true;
            updateProgressBar();
        }

        function shuffleAll() {
            for (let i = questionsForQuiz.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questionsForQuiz[i], questionsForQuiz[j]] = [questionsForQuiz[j], questionsForQuiz[i]];
            }

            questionsForQuiz.forEach(q => {
                if ((q.type === 'single' || q.type === 'multiple') && q.options) {
                    const optionsWithAnswers = q.options.map((option, index) => ({
                        text: option,
                        isCorrect: q.correct.includes(index)
                    }));

                    for (let i = optionsWithAnswers.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [optionsWithAnswers[i], optionsWithAnswers[j]] = [optionsWithAnswers[j], optionsWithAnswers[i]];
                    }

                    q.options = optionsWithAnswers.map(item => item.text);
                    q.correct = optionsWithAnswers.map((item, index) => item.isCorrect ? index : -1).filter(index => index !== -1);
                }
            });

            alert("Đã trộn câu hỏi và đáp án!");
        }

        function saveAnswer() {
            if (!quizStarted) return;
            const questionData = questionsForQuiz[currentQuestionIndex];
            const questionCard = document.querySelector('.question-card');
            if (!questionCard) return;

            let currentAnswer = null;

            switch (questionData.type) {
                case 'single':
                case 'multiple':
                    const selectedOptions = Array.from(questionCard.querySelectorAll('input:checked')).map(input => parseInt(input.value));
                    if (selectedOptions.length > 0) {
                        currentAnswer = selectedOptions;
                    }
                    break;

                case 'group-radio':
                    const subAnswers = [];
                    const groups = questionCard.querySelectorAll('.option-group');
                    let allAnswered = true;
                    groups.forEach((group, index) => {
                        const checkedRadio = group.querySelector('input:checked');
                        if (checkedRadio) {
                            subAnswers[index] = parseInt(checkedRadio.value);
                        } else {
                            subAnswers[index] = null;
                        }
                    });
                    if (subAnswers.some(ans => ans !== null)) {
                        currentAnswer = subAnswers;
                    }
                    break;

                case 'fill-in-blanks':
                    const inputs = Array.from(questionCard.querySelectorAll('input[type="text"]'));
                    const filledAnswers = inputs.map(input => input.value.trim());
                    if (filledAnswers.some(ans => ans !== '')) {
                        currentAnswer = filledAnswers;
                    }
                    break;

                case 'drag-drop':
                    const dropAreas = Array.from(questionCard.querySelectorAll('.drop-area'));
                    const droppedAnswers = dropAreas.map(area => {
                        const item = area.querySelector('.drag-item'); // 1. Tìm phần tử trước và lưu vào biến 'item'
                        return item ? item.textContent.trim() : null; // 2. Nếu có 'item', lấy textContent của nó. Nếu không, trả về null.
                    });
                    if (droppedAnswers.some(ans => ans !== null)) {
                        currentAnswer = droppedAnswers;
                    }
                    break;
            }

            userAnswers[currentQuestionIndex] = currentAnswer;
        }

        function displayQuestion() {
            const quizContent = document.getElementById('quizContent');
            const questionData = questionsForQuiz[currentQuestionIndex];
            quizContent.innerHTML = '';

            const card = document.createElement('div');
            card.className = 'question-card';

            card.innerHTML = `
            <div class="question-header">
                <span class="question-number">Câu ${currentQuestionIndex + 1} / ${questionsForQuiz.length}</span>
            </div>
            <p class="question-text">${questionData.question}</p>
            `;

            switch (questionData.type) {
                case 'single':
                case 'multiple':
                    card.appendChild(createOptions(questionData));
                    break;
                case 'group-radio':
                    card.appendChild(createGroupRadio(questionData));
                    break;
                case 'drag-drop':
                    card.appendChild(createDragDrop(questionData));
                    break;
                case 'fill-in-blanks':
                    card.appendChild(createFillInBlanks(questionData));
                    break;
            }

            card.appendChild(createNavigation());
            quizContent.appendChild(card);

            if (questionData.type === 'drag-drop') {
                initializeDragDrop();
            }

            updateProgressBar();
        }

        function createOptions(questionData) {
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options';
            const savedAnswer = userAnswers[currentQuestionIndex];

            questionData.options.forEach((optionText, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                if (questionData.options.length % 2 !== 0 && index === questionData.options.length - 1) {
                    optionDiv.classList.add('full-width');
                }

                const inputType = questionData.type === 'single' ? 'radio' : 'checkbox';
                const input = document.createElement('input');
                input.type = inputType;
                input.name = `question-${currentQuestionIndex}`;
                input.value = index;
                input.id = `q${currentQuestionIndex}-op${index}`;

                if (savedAnswer && savedAnswer.includes(index)) {
                    input.checked = true;
                }

                const label = document.createElement('label');
                label.htmlFor = `q${currentQuestionIndex}-op${index}`;
                label.textContent = optionText;

                optionDiv.appendChild(input);
                optionDiv.appendChild(label);
                optionsContainer.appendChild(optionDiv);
            });
            return optionsContainer;
        }

        function createGroupRadio(questionData) {
            const container = document.createElement('div');
            container.className = 'group-radio-container';
            const savedSubAnswers = userAnswers[currentQuestionIndex];

            questionData.subQuestions.forEach((sub, subIndex) => {
                const subContainer = document.createElement('div');
                subContainer.className = 'option-group';
                subContainer.style.marginBottom = '15px';

                const stem = document.createElement('p');
                stem.textContent = sub.stem;
                stem.style.marginBottom = '8px';
                stem.style.fontWeight = '500';
                subContainer.appendChild(stem);

                const optionsDiv = document.createElement('div');
                optionsDiv.style.display = 'flex';
                optionsDiv.style.gap = '20px';

                sub.options.forEach((opt, optIndex) => {
                    const optionWrapper = document.createElement('div');
                    optionWrapper.style.display = 'flex';
                    optionWrapper.style.alignItems = 'center';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `question-${currentQuestionIndex}-sub-${subIndex}`;
                    input.value = optIndex;
                    input.id = `q${currentQuestionIndex}-s${subIndex}-op${optIndex}`;

                    if (savedSubAnswers && savedSubAnswers[subIndex] === optIndex) {
                        input.checked = true;
                    }

                    const label = document.createElement('label');
                    label.htmlFor = input.id;
                    label.textContent = opt;
                    label.style.marginLeft = '8px';

                    optionWrapper.appendChild(input);
                    optionWrapper.appendChild(label);
                    optionsDiv.appendChild(optionWrapper);
                });
                subContainer.appendChild(optionsDiv);
                container.appendChild(subContainer);
            });
            return container;
        }

        function createFillInBlanks(questionData) {
            const container = document.createElement('div');
            container.className = 'fill-in-blanks-container';
            const savedAnswer = userAnswers[currentQuestionIndex];

            questionData.blanks.forEach((blank, index) => {
                const group = document.createElement('div');
                group.className = 'blank-input-group';

                const label = document.createElement('label');
                label.htmlFor = `q${currentQuestionIndex}-blank${index}`;
                label.textContent = blank.label;

                const input = document.createElement('input');
                input.type = 'text';
                input.id = `q${currentQuestionIndex}-blank${index}`;
                input.placeholder = `Điền vào ô trống (${index + 1})...`;

                if (savedAnswer && savedAnswer[index]) {
                    input.value = savedAnswer[index];
                }

                group.appendChild(label);
                group.appendChild(input);
                container.appendChild(group);
            });
            return container;
        }

        function createDragDrop(questionData) {
            const container = document.createElement('div');
            container.className = 'drag-drop-container';

            const dragSource = document.createElement('div');
            dragSource.className = 'drag-items';
            dragSource.innerHTML = '<h4>Kéo từ đây:</h4>';

            const dropTargetContainer = document.createElement('div');
            dropTargetContainer.className = 'drop-targets';
            dropTargetContainer.innerHTML = '<h4>Thả vào đây:</h4>';

            const savedAnswer = userAnswers[currentQuestionIndex];
            const usedDragItems = savedAnswer ? [...savedAnswer] : [];

            questionData.dropTargets.forEach((target, index) => {
                const dropTarget = document.createElement('div');
                dropTarget.className = 'drop-target';
                dropTarget.innerHTML = `<span class="label">${target.label}</span>`;

                const dropArea = document.createElement('div');
                dropArea.className = 'drop-area';
                dropArea.dataset.targetIndex = index;

                if (savedAnswer && savedAnswer[index]) {
                    const itemText = savedAnswer[index];
                    const dragItem = document.createElement('div');
                    dragItem.className = 'drag-item';
                    dragItem.textContent = itemText;
                    dragItem.draggable = true;
                    dragItem.id = `q${currentQuestionIndex}-drag-${itemText.replace(/\s/g, '-')}`;
                    dropArea.appendChild(dragItem);
                }

                dropTarget.appendChild(dropArea);
                dropTargetContainer.appendChild(dropTarget);
            });

            questionData.dragItems.forEach(itemText => {
                if (!usedDragItems.includes(itemText)) {
                    const dragItem = document.createElement('div');
                    dragItem.className = 'drag-item';
                    dragItem.textContent = itemText;
                    dragItem.draggable = true;
                    dragItem.id = `q${currentQuestionIndex}-drag-${itemText.replace(/\s/g, '-')}`;
                    dragSource.appendChild(dragItem);
                }
            });

            container.appendChild(dragSource);
            container.appendChild(dropTargetContainer);
            return container;
        }

        function createNavigation() {
            const nav = document.createElement('div');
            nav.className = 'navigation';

            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Câu trước';
            prevBtn.className = 'btn btn-primary';
            prevBtn.onclick = prevQuestion;
            prevBtn.disabled = currentQuestionIndex === 0;

            const nextBtn = document.createElement('button');
            nextBtn.className = 'btn btn-primary';

            if (currentQuestionIndex < questionsForQuiz.length - 1) {
                nextBtn.textContent = 'Câu sau';
                nextBtn.onclick = nextQuestion;
            } else {
                nextBtn.textContent = 'Nộp bài';
                nextBtn.className = 'btn btn-success';
                nextBtn.onclick = submitQuiz;
            }

            nav.appendChild(prevBtn);
            nav.appendChild(nextBtn);
            return nav;
        }

        function nextQuestion() {
            saveAnswer();
            if (currentQuestionIndex < questionsForQuiz.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        function prevQuestion() {
            saveAnswer();
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function submitQuiz() {
            saveAnswer();
            calculateResults();
        }

        function calculateResults() {
            let correctAnswersCount = 0;
            questionsForQuiz.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                if (!userAnswer) return;

                let isCorrect = false;
                switch (question.type) {
                    case 'single':
                        isCorrect = userAnswer[0] === question.correct[0];
                        break;
                    case 'multiple':
                        isCorrect = question.correct.length === userAnswer.length &&
                            question.correct.every(val => userAnswer.includes(val));
                        break;
                    case 'group-radio':
                        isCorrect = userAnswer.every((ans, i) => ans === question.subQuestions[i].correct);
                        break;
                    case 'fill-in-blanks':
                        isCorrect = userAnswer.every((ans, i) => ans.toLowerCase() === question.blanks[i].answer.toLowerCase());
                        break;
                    case 'drag-drop':
                        const correctDropAnswers = question.dropTargets.map(t => t.correct);
                        isCorrect = userAnswer.every((ans, i) => ans === correctDropAnswers[i]);
                        break;
                }

                if (isCorrect) {
                    correctAnswersCount++;
                }
            });

            displayResults(correctAnswersCount);
        }

        function displayResults(correctCount) {
            const total = questionsForQuiz.length;
            const incorrectCount = total - correctCount;
            const percentage = total > 0 ? Math.round((correctCount / total) * 100) : 0;

            document.getElementById('quizContent').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');

            document.getElementById('finalScore').textContent = `${correctCount} / ${total}`;
            document.getElementById('percentage').textContent = `${percentage}%`;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
        }

        function updateProgressBar() {
            const progress = quizStarted ? ((currentQuestionIndex) / questionsForQuiz.length) * 100 : 0;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }


        function initializeDragDrop() {
            const draggables = document.querySelectorAll('.drag-item');
            const dropAreas = document.querySelectorAll('.drop-area');
            const dragSource = document.querySelector('.drag-items');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => {
                    draggable.classList.add('dragging');
                });
                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                });
            });

            dropAreas.forEach(area => {
                area.addEventListener('dragover', e => {
                    e.preventDefault();
                    if (!area.hasChildNodes()) {
                        area.parentElement.classList.add('over');
                    }
                });
                area.addEventListener('dragleave', () => {
                    area.parentElement.classList.remove('over');
                });
                area.addEventListener('drop', e => {
                    e.preventDefault();
                    area.parentElement.classList.remove('over');
                    const draggingItem = document.querySelector('.dragging');
                    if (draggingItem && !area.hasChildNodes()) {
                        area.appendChild(draggingItem);
                    }
                });
            });

            if (dragSource) {
                dragSource.addEventListener('dragover', e => e.preventDefault());
                dragSource.addEventListener('drop', e => {
                    e.preventDefault();
                    const draggingItem = document.querySelector('.dragging');
                    if (draggingItem) {
                        dragSource.appendChild(draggingItem);
                    }
                });
            }
        }
    </script>

</body>

</html>
